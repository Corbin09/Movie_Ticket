<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <title>Ticket Booking</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Movie ticket booking system" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/index.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/font.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/component.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/css/pick-seat.css}" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
<div class="register">
    <div class="stackheaderlogo-3">
        <div class="column_eight-1">
            <div class="column_two-1">
                <div class="rowcaptainameri">
                    <div class="column-15">
                        <header class="header-1" th:replace="fragments/header :: header"></header>
                        <img th:src="${film.poster}" alt="Image" class="image" />
                    </div>
                    <div class="columninvasha-1">
                        <div class="row_two-1">
                            <div class="row_one-3">
                                <div class="rowinvasha-1 container-lg">
                                    <h1 class="createan ui heading size-headingloXl" th:text="${film.title}">INVASHA</h1>
                                </div>
                            </div>
                            <div class="column_one-11 container-lg">
                                <img th:src="${film.poster}" alt="Image" class="image_three" />
                            </div>
                        </div>
                    </div>
                    <div class="column_seven">
                        <div class="column_four container-lg">
                            <div class="listm_lthn">
                                <div class="title-1">
                                    <div class="row_three-3">
                                        <div class="rowtwo-2">
                                            <button class="one-4 ui button gray_600 size-sm fill active">01</button>
                                            <h2 class="pickseat-3 ui heading size-headingx1">PICK SEAT</h2>
                                        </div>
                                    </div>
                                    <div class="rowgroupthirtyp">
                                        <h3 class="groupthirtyone ui heading size-headingx1">02</h3>
                                        <h4 class="pickseat-3 ui heading size-headingx1">POPCORN</h4>
                                    </div>
                                    <div class="rowgroupthirtyt">
                                        <h5 class="groupthirtytwo ui heading size-headingx1">03</h5>
                                        <h6 class="pickseat-3 ui heading size-headingx1">PAY</h6>
                                    </div>
                                    <div class="rowgroupthirtyt-1">
                                        <h6 class="groupthirtyone ui heading size-headingx1">04</h6>
                                        <h6 class="pickseat-3 ui heading size-headingx1">TICKET</h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="tabpanel01" role="tabpanel" aria-labelledby="tab01" class="row_twelve tabcontent">
                            <div class="row_eleven">
                                <div class="column_four-2">
                                    <!-- Screen image -->
                                    <img src="images/screen.svg" alt="Screen" class="image_four-1" />
                                    <div class="column_three-11">
                                        <div class="seat-container">
                                            <!-- Seat grid - Reorganized for better alignment -->
                                            <div class="seat-grid">
                                                <!-- Rows 1-3 -->
                                                <div class="seat-row" th:each="row : ${#numbers.sequence(1, 3)}">
                                                    <div class="row-label" th:text="${row}">1</div>
                                                    <div th:each="col : ${#numbers.sequence(1, 10)}"
                                                         th:id="'seat-' + ${row} + '-' + ${col}"
                                                         th:data-row="${row}"
                                                         th:data-col="${col}"
                                                         th:data-price="15"
                                                         th:data-type="'normal'"
                                                         class="seat normal-seat"
                                                         th:classappend="${row == 1 && (col == 3 || col == 7)} ? 'reserved-seat' : ''">
                                                    </div>
                                                </div>

                                                <!-- Rows 4-6 (VIP) -->
                                                <div class="seat-row" th:each="row : ${#numbers.sequence(4, 6)}">
                                                    <div class="row-label" th:text="${row}">4</div>
                                                    <div th:each="col : ${#numbers.sequence(1, 12)}"
                                                         th:id="'seat-' + ${row} + '-' + ${col}"
                                                         th:data-row="${row}"
                                                         th:data-col="${col}"
                                                         th:data-price="20"
                                                         th:data-type="'vip'"
                                                         class="seat vip-seat"
                                                         th:classappend="${row == 5 && col == 6} ? 'reserved-seat' : ''">
                                                    </div>
                                                </div>

                                                <!-- Rows 7-9 -->
                                                <div class="seat-row" th:each="row : ${#numbers.sequence(7, 9)}">
                                                    <div class="row-label" th:text="${row}">7</div>
                                                    <div th:each="col : ${#numbers.sequence(1, 10)}"
                                                         th:id="'seat-' + ${row} + '-' + ${col}"
                                                         th:data-row="${row}"
                                                         th:data-col="${col}"
                                                         th:data-price="${(row == 9 && (col == 4 || col == 6)) ? '25' : '15'}"
                                                         th:data-type="${(row == 9 && (col == 4 || col == 6)) ? 'couple' : 'normal'}"
                                                         class="seat"
                                                         th:classappend="${(row == 8 && col == 5) || (row == 9 && col == 2)} ? 'reserved-seat' : ((row == 9 && (col == 4 || col == 6)) ? 'couple-seat' : 'normal-seat')">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="seattype">
                                        <div class="rowview_three">
                                            <div class="view_three"></div>
                                            <p class="time-1 ui text size-texts">Normal seat</p>
                                        </div>
                                        <div class="rowview_four">
                                            <div class="view_four"></div>
                                            <p class="time-1 ui text size-texts">VIP seat</p>
                                        </div>
                                        <div class="rowview_five">
                                            <div class="view_five"></div>
                                            <p class="time-1 ui text size-texts">Couple seat</p>
                                        </div>
                                        <div class="rowview_six">
                                            <div class="view_six"></div>
                                            <p class="time-1 ui text size-texts">Reserved seat</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="column_five-2">
                                    <div class="columndecounte">
                                        <div class="columnhtmltn-3">
                                            <p class="time-1 ui text size-text3xl">Date:</p>
                                        </div>
                                        <div class="rowdeccounter">
                                            <p class="deccounter ui text size-text5xl" th:text="${#dates.format(showtime.date, 'dd MMM')}">08 DEC</p>
                                        </div>
                                    </div>
                                    <div class="column">
                                        <p class="time-1 ui text size-text3xl">Time:</p>
                                        <h2 class="createan ui heading size-heading3xl" th:text="${#dates.format(showtime.startTime, 'h:mm a')}">9:40 pm</h2>
                                    </div>
                                    <div class="columnsetmew">
                                        <p class="time-1 ui text size-text3xl">Room:</p>
                                        <h3 class="createan ui heading size-heading3xl" th:text="${showtime.room.name}">A1</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column9row7thse">
                    <div id="selected-seats-container" class="list9rowThiseat">
                        <!-- Selected seats will be dynamically added here -->
                    </div>
                    <div class="price-4">
                        <p class="total ui text size-textxl">Total:</p>
                        <h2 id="total-price" class="price-5 ui heading size-headingxxl">$0</h2>
                    </div>
                    <div class="button-container">
                        <button class="cancel-btn" onclick="window.location.href='view-ticket-pay.html'">Cancel</button>
                        <button class="next-btn" id="next-button" onclick="window.location.href='popcorn.html'">Next</button>
                    </div>
                </div>
                <footer class="footer-6" th:replace="fragments/footer :: footer"></footer>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const seats = document.querySelectorAll('.seat:not(.reserved-seat)');
        const selectedSeatsContainer = document.getElementById('selected-seats-container');
        const totalPriceElement = document.getElementById('total-price');
        const nextButton = document.getElementById('next-button');
        let selectedSeats = [];
        let totalPrice = 0;

        // Disable next button initially if no seats selected
        updateNextButtonState();

        // Add click event listeners to all non-reserved seats
        seats.forEach(seat => {
            seat.addEventListener('click', function() {
                const seatId = this.id;
                const row = this.dataset.row;
                const col = this.dataset.col;
                const price = parseInt(this.dataset.price);
                const seatType = this.dataset.type;

                // Check if seat is already selected
                if (this.classList.contains('selected-seat')) {
                    // Remove seat from selected seats
                    this.classList.remove('selected-seat');
                    removeSeatFromSelection(seatId);
                } else {
                    // Add seat to selected seats
                    this.classList.add('selected-seat');
                    addSeatToSelection(seatId, row, col, price, seatType);
                }

                updateTotalPrice();
                updateNextButtonState();
            });
        });

        function addSeatToSelection(seatId, row, col, price, seatType) {
            // Create selected seat element
            const seatElement = document.createElement('div');
            seatElement.classList.add('ticket-choice');
            seatElement.id = `selected-${seatId}`;

            // Get the seat type text
            let seatTypeText = "Normal seat";
            if (seatType === 'vip') seatTypeText = "VIP seat";
            if (seatType === 'couple') seatTypeText = "Couple seat";

            seatElement.innerHTML = `
                <p class="ticket-choice-text ui text size-textlg">${row} row ${col}th seat</p>
                <p class="ticket-price ui text size-texts">$${price}</p>
                <i class="fas fa-times ticket-close" onclick="removeSeat('${seatId}')"></i>
            `;
            selectedSeatsContainer.appendChild(seatElement);

            // Add seat to selected seats array
            selectedSeats.push({
                id: seatId,
                row: row,
                col: col,
                price: price,
                type: seatType
            });
        }

        function removeSeatFromSelection(seatId) {
            // Remove seat element from DOM
            const seatElement = document.getElementById(`selected-${seatId}`);
            if (seatElement) {
                seatElement.remove();
            }

            // Remove seat from selected seats array
            selectedSeats = selectedSeats.filter(seat => seat.id !== seatId);

            // Deselect the seat on the grid
            const seat = document.getElementById(seatId);
            if (seat) {
                seat.classList.remove('selected-seat');
            }
        }

        function updateTotalPrice() {
            // Calculate total price
            totalPrice = selectedSeats.reduce((total, seat) => total + seat.price, 0);
            totalPriceElement.textContent = `$${totalPrice}`;
        }

        function updateNextButtonState() {
            // Enable next button only if seats are selected
            nextButton.disabled = selectedSeats.length === 0;
            if (selectedSeats.length === 0) {
                nextButton.classList.add('disabled');
            } else {
                nextButton.classList.remove('disabled');
            }
        }

        // Make removeSeat function global so it can be called from the HTML
        window.removeSeat = function(seatId) {
            removeSeatFromSelection(seatId);
            updateTotalPrice();
            updateNextButtonState();
        };

        // Optional: Save selected seats to sessionStorage to access on the next page
        nextButton.addEventListener('click', function(e) {
            if (selectedSeats.length === 0) {
                e.preventDefault();
                alert('Please select at least one seat before proceeding.');
                return;
            }

            // Store selected seats in sessionStorage
            sessionStorage.setItem('selectedSeats', JSON.stringify(selectedSeats));
            sessionStorage.setItem('totalPrice', totalPrice);
        });
    });
</script>

<style>
    /* Main layout styles */
    body {
        background-color: #020202;
        color: #ffffff;
        font-family: Poppins, sans-serif;
    }

    /* Button container styling */
    .button-container {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
        width: 100%;
        max-width: 220px;
        position: absolute;
        bottom: 20px;
        right: 20px;
    }

    /* Cancel button styling */
    .cancel-btn {
        background-color: #000000;
        color: #FF0000; /* Red text color */
        border: 1px solid #FF0000; /* Red border */
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-family: Poppins, sans-serif;
        font-weight: 600;
        text-transform: uppercase;
        transition: all 0.3s ease;
        width: 100px;
    }

    .cancel-btn:hover {
        background-color: rgba(255, 0, 0, 0.1);
    }

    /* Next button styling */
    .next-btn {
        background-color: #FF0000; /* Red background */
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-family: Poppins, sans-serif;
        font-weight: 600;
        text-transform: uppercase;
        transition: background-color 0.3s ease;
        width: 100px;
    }

    .next-btn:hover {
        background-color: #D10000; /* Darker red on hover */
    }

    .next-btn.disabled {
        background-color: #666666;
        cursor: not-allowed;
    }

    /* Position the column9row7thse for proper layout */
    .column9row7thse {
        position: relative;
        padding-bottom: 70px; /* Add space for the buttons */
        background-color: #111111;
        border-radius: 6px;
        margin-top: 20px;
        padding: 20px;
    }

    /* Ticket choice styles - replacing waocombo */
    .ticket-choice {
        background-color: #000000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        border-radius: 4px;
        border: 1px solid #333333;
        margin-bottom: 10px;
        position: relative;
    }

    .ticket-choice-text {
        color: white;
        font-family: Poppins, sans-serif;
        font-size: 14px;
    }

    .ticket-price {
        color: #999999 !important;
        font-family: Poppins, sans-serif;
        margin-right: 10px;
    }

    .ticket-close {
        color: #999999;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .ticket-close:hover {
        color: #FF0000;
    }

    /* Selected seats container */
    #selected-seats-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
    }

    /* Total price styling */
    .price-4 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
        padding: 10px 0;
        border-top: 1px solid #333333;
        margin-bottom: 30px;
    }

    .total {
        color: #999999;
        font-family: Poppins, sans-serif;
        font-size: 18px;
        text-transform: uppercase;
    }

    #total-price {
        color: white;
        font-family: Poppins, sans-serif;
        font-size: 28px;
        font-weight: bold;
    }

    /* Update seat grid styles */
    .seat-grid {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
        margin: 20px 0;
    }

    .seat-row {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .row-label {
        width: 20px;
        text-align: center;
        color: #999999;
        font-family: Poppins, sans-serif;
    }

    .seat {
        width: 24px;
        height: 24px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .normal-seat {
        background-color: #333333;
    }

    .vip-seat {
        background-color: #FFA500; /* Orange for VIP seats */
    }

    .couple-seat {
        background-color: #FF0000; /* Red for couple seats */
        width: 48px;
    }

    .reserved-seat {
        background-color: #111111;
        cursor: not-allowed;
    }

    .selected-seat {
        background-color: #007BFF; /* Blue for selected seats */
        transform: scale(1.1);
    }

    /* Legend styles */
    .seattype {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
    }

    .rowview_three, .rowview_four, .rowview_five, .rowview_six {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .view_three, .view_four, .view_five, .view_six {
        width: 15px;
        height: 15px;
        border-radius: 3px;
    }

    .view_three {
        background-color: #333333; /* Normal seat */
    }

    .view_four {
        background-color: #FFA500; /* VIP seat */
    }

    .view_five {
        background-color: #FF0000; /* Couple seat */
    }

    .view_six {
        background-color: #111111; /* Reserved seat */
        border: 1px solid #333333;
    }

    /* Screen styling */
    .image_four-1 {
        width: 100%;
        max-width: 400px;
        margin: 0 auto;
        display: block;
    }

    /* Right side info panel */
    .column_five-2 {
        padding: 20px;
        background-color: #111111;
        border-radius: 6px;
        margin-left: 20px;
    }

    .columndecounte, .column, .columnsetmew {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #333333;
    }

    .time-1 {
        color: #999999;
        margin-bottom: 5px;
    }

    .deccounter, .createan {
        color: white;
        font-weight: bold;
        font-size: 24px;
    }

    /* Make layout responsive */
    @media only screen and (max-width: 768px) {
        .row_eleven {
            flex-direction: column;
        }

        .column_five-2 {
            margin-left: 0;
            margin-top: 20px;
        }

        .button-container {
            position: static;
            margin: 20px auto;
        }
    }
</style>
</body>
</html>